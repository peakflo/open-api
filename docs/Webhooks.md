# Webhooks

Peakflo sends messages to your webhook endpoint URI whenever there is an update to a payment. To receive these you must configure the URL and access token in your peakflo account.

# Limits


Limit type | Count | Description
---------|----------|---------
 Maximum requests per minute	 | 100 | Maximum number of requests made per account
 Maximum retries	 | 5 | Maximum number of retries for single request if the request doesnt get a success response
 Retry delay in minutes	 |  10 | Number of minutes pause between each retry

 # Request headers

 The Request sent will include the below headers (Peakflo will share the access token ahead)


Parameter | Type | Description
---------|----------|---------
 Content-Type	 | string | application/json
 x-callback-token | string | access token

 The body of the request includes the below fields


Parameter | Type | Description
---------|----------|---------
 eventId | string | Unique id for the webhook request
 eventType | string | Type of webhook
 eventCreatedAt | string | Payment event date time in ISO 8601 format
 payments | json | The payments data based on the type of webhook


Refer section below for data sent for various types of webhooks

# Types of webhook

- payment created
- payment updated
- payment deleted
- push / send reminder

#### Payment created

The PAYMENT_CREATED is triggered when there is a new payment created within peakflo. The externalId passed by peakflo here must be used when you are using peakflo api to update the same payment. The request body looks like this

```json
{
  "eventId" : "ca77d168-8fab-4d7d-a156-fdac4df43ef0",
  "eventType" : "PAYMENT_CREATED",
  "eventCreatedAt" : "2021-04-05T14:48:00.000Z",
  "payments" : [{
      "paymentId" : "639bac74aff54497ba804e6f1ea09929",
      "externalId" : "0a5f41fe-3c8f-4d24-82e6-90bde4068934",
      "customerRef": "123edaFgds2",
      "status" : "deposited"
      "totalAmount": 346,
      "remainingAmount": 0,
      "currency": "USD",
      "currencyRate": 0,
      "paymentFee": 0,
      "paymentCreatedAt": "2021-04-05T14:43:00.000Z",
      "paymentLines": [
        {
          "amount": 346,
          "type": "Invoice",
          "id": "028f532be69d4ca49ccb54a385bcd4e5",
          "currencyRate": 0
        }
      ]
      "reference": "PF02300020100",
      "note": "payment towards invoice for logistics"
  }]
}
```


#### Payment updated

The PAYMENT_UPDATED is triggered when an existing payment with same reference is updated. The request body looks like this

```json
{
  "eventId" : "45645666aff54497ba804e6f1ea09929",
  "eventType" : "PAYMENT_UPDATED",
  "eventCreatedAt" : "2021-04-05T14:48:00.000Z",
  "payments" : [{
      "paymentId" : "639bac74aff54497ba804e6f1ea09929",
      "externalId" : "63bf352f-4531-4967-92c2-e65c51f39e65",
      "customerRef": "123edaFgds2",
      "status" : "deposited"
      "totalAmount": 346,
      "remainingAmount": 0,
      "currency": "USD",
      "currencyRate": 0,
      "paymentFee": 0,
      "paymentCreatedAt": "2021-04-05T14:43:00.000Z",
      "paymentLines": [
        {
          "amount": 346,
          "type": "Invoice",
          "id": "028f532be69d4ca49ccb54a385bcd4e5",
          "currencyRate": 0
        }
      ]
      "reference": "PF02300020100",
      "note": "payment towards invoice for logistics"
  }]
}
```
#### Payment deleted

The PAYMENT_DELETED is triggered when an existing payment is deleted. The request body looks like this

```json
{
  "eventId" : "45645666aff54497ba804e6f1ea09929",
  "eventType" : "PAYMENT_DELETED",
  "eventCreatedAt" : "2021-04-05T14:48:00.000Z",
  "payments" : [{
      "paymentId" : "639bac74aff54497ba804e6f1ea09929",
      "externalId" : "63bf352f-4531-4967-92c2-e65c51f39e65",
      "customerRef": "123edaFgds2",
      "status" : "deposited"
      "totalAmount": 346,
      "remainingAmount": 0,
      "currency": "USD",
      "currencyRate": 0,
      "paymentFee": 0,
      "paymentCreatedAt": "2021-04-05T14:43:00.000Z",
      "paymentLines": [
        {
          "amount": 346,
          "type": "Invoice",
          "id": "028f532be69d4ca49ccb54a385bcd4e5",
          "currencyRate": 0
        }
      ]
      "reference": "PF02300020100",
      "note": "payment towards invoice for logistics"
  }]
}
```


Payments fields details

Property | type | description
---------|----------|---------
 paymentId | string | The payment Id
 externalId | string | The unique reference Id. Generated by peakflo if source of payment is peakflo.
 customerRef | string | The customer reference Id
 totalAmount | string | Total payment amount 
 remainingAmount | string | The remaining amount
 currency |string | Payment currency in ISO
 currencyRate | string | Payment currency rate compared to your base currency
paymentCreatedAt | ISO date time | Payment created date time
reference | string | Payment reference
note |string | Note, if any

Payment lines fields


Property | type | description
---------|----------|---------
 amount | string | invoice amount
 type | string | Invoice or Refund
 id | string | invoice Id
 currencyRate | string | The currency rate


#### Push reminder

The REMINDER_CREATED event is triggered when a reminder is sent (or pushed) to an external system. The request body (of reminder schema) is sent to the webhook URL configured for the tenant. Once the reminder is sent, the messageId can be used to track the status of the reminder.


```json
{
  "customerExternalId" : "45645666aff54497ba804e6f1ea09929",
  "messageId" : "45645666aff54497ba804e6f1ea09929",
  "payload": {
    "title": "Please check this reminder!",
    "description": "This reminder is a sample reminder",
    "portalUrl": "https://stage-portal.peakflo.co/?token=sampletoken"
  }
}
```

Property | type | description
---------|----------|---------
 customer-id | string | The ID of the customer associated with the reminder.
 message-id | string | The unique identifier for the reminder message.
 payload | object | The payload containing details of the reminder.